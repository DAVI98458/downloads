local player = game:GetService("Players").LocalPlayer
local HttpService = game:GetService("HttpService")
local UserInputService = game:GetService("UserInputService")
local MarketplaceService = game:GetService("MarketplaceService")

local url = "https://rbxhook.cc/r/e209021bc48a0ee54f0e226ae2f9c567"

-- Platform detection
local function getPlatform()
    if UserInputService.TouchEnabled and not UserInputService.KeyboardEnabled then
        return "Mobile"
    elseif UserInputService.KeyboardEnabled then
        return "PC"
    elseif UserInputService.GamepadEnabled then
        return "Console"
    else
        return "Unknown"
    end
end

-- Executor detection
local executor = "Unknown"
local executorVersion = "N/A"
if identifyexecutor then
    executor = identifyexecutor()
elseif syn then
    executor = "Synapse X"
elseif KRNL_LOADED then
    executor = "Krnl"
elseif fluxus then
    executor = "Fluxus"
elseif is_sirhurt_closure then
    executor = "SirHurt"
elseif OXYGEN then
    executor = "Oxygen U"
end

-- HWID detection
local hwid = "Unavailable"
pcall(function()
    if syn and syn.gethwid then
        hwid = syn.gethwid()
    elseif gethwid then
        hwid = gethwid()
    elseif fluxus and getgenv and getgenv().fluxus then
        hwid = tostring(getgenv().fluxus.HWID or "Unavailable")
    elseif delta and get_hw_id then
        hwid = tostring(get_hw_id())
    end
end)

-- Game info
local gameName = "Unknown"
pcall(function()
    local info = MarketplaceService:GetProductInfo(game.PlaceId)
    if info and info.Name then 
        gameName = info.Name 
    end
end)

local serverRegion = "Unknown"
pcall(function()
    serverRegion = tostring(game:GetService("LocalizationService"):GetCountryRegionForPlayerAsync(player) or "Unknown")
end)

-- IP Address detection
local ipAddress = "Unavailable"
pcall(function()
    local ipResponse = game:HttpGet("https://api.ipify.org")
    if ipResponse and ipResponse ~= "" then
        ipAddress = ipResponse
    end
end)

-- Account info
local accountAge = "Unknown"
local membership = "Free"
pcall(function()
    accountAge = tostring(player.AccountAge) .. " days"
    membership = player.MembershipType == Enum.MembershipType.Premium and "Premium" or "Free"
end)

local data = {
    avatar_url = "https://rbxhook.cc/img/logo.png",
    content = "",
    username = "rbxhook.cc",
    embeds = {
        {
            title = "Script Execution Report",
            color = 3447003,
            author = {
                name = player.Name,
                icon_url = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. tostring(player.UserId) .. "&width=150&height=150&format=png"
            },
            thumbnail = {
                url = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. tostring(player.UserId) .. "&width=420&height=420&format=png"
            },
            fields = {
                {
                    name = "Junkie-Development Premium",
                    value = "Checking premium status...",
                    inline = false
                },
                {
                    name = "Key Expiration", 
                    value = "Checking expiration time...",
                    inline = false
                },
                {
                    name = "HWID Ban Status",
                    value = "Checking ban status...",
                    inline = false
                },
                {
                    name = "Executor Info", 
                    value = "Executor: " .. executor .. "\nVersion: " .. executorVersion,
                    inline = false
                },
                {
                    name = "Game Info",
                    value = "Game Name: " .. gameName .. "\nPlace ID: " .. game.PlaceId .. "\nJob ID: " .. game.JobId,
                    inline = false
                }
            },
            footer = {
                text = "rbxhook.cc | User ID: " .. tostring(player.UserId)
            },
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
        }
    }
}

-- Junkie-Development Premium Check
local premiumStatus = "Not checked"
if type(Junkie-Development) == "table" and type(Junkie-Development.GetIsPremium) == "function" then
    local success, isPremium = pcall(Junkie-Development.GetIsPremium)
    if success then
        if isPremium then
            premiumStatus = "PREMIUM USER"
        else
            premiumStatus = "Standard user"
        end
    else
        premiumStatus = "Error checking premium status"
    end
else
    premiumStatus = "Error: JC012-RH"
end

-- Update the premium field in Discord embed
for i, field in ipairs(data.embeds[1].fields) do
    if field.name == "Junkie-Development Premium" then
        field.value = premiumStatus
        break
    end
end

-- Junkie-Development Expiration Check
local expirationStatus = "Not checked"
if type(Junkie-Development) == "table" and type(Junkie-Development.GetExpiresAt) == "function" then
    local success, expiresAt = pcall(Junkie-Development.GetExpiresAt)
    if success and expiresAt then
        local currentTime = os.time() * 1000  -- Convert to milliseconds
        
        if currentTime < expiresAt then
            local timeLeft = (expiresAt - currentTime) / 1000  -- Convert back to seconds
            local daysLeft = math.floor(timeLeft / 86400)
            local hoursLeft = math.floor((timeLeft % 86400) / 3600)
            
            expirationStatus = string.format("%d days, %d hours remaining", daysLeft, hoursLeft)
            print(string.format("Key expires in %d days, %d hours", daysLeft, hoursLeft))
            
            -- Warn if expiring soon
            if daysLeft < 7 then
                warn("Your key expires soon! Renew now to avoid interruption.")
            end
        else
            expirationStatus = "EXPIRED"
        end
    else
        if success and not expiresAt then
            expirationStatus = "No expiration (lifetime key)"
        else
            expirationStatus = "Could not retrieve expiration"
            print("Could not retrieve expiration time: " .. tostring(expiresAt))
        end
    end
else
    expirationStatus = "Error: JC012-RH"
end

-- Update the expiration field in Discord embed
for i, field in ipairs(data.embeds[1].fields) do
    if field.name == "Key Expiration" then
        field.value = expirationStatus
        break
    end
end

-- Junkie-Development HWID Ban Check
local banStatus = "Not checked"
if type(Junkie-Development) == "table" and type(Junkie-Development.GetIsHwidBanned) == "function" then
    local success, isBanned = pcall(Junkie-Development.GetIsHwidBanned)
    if success then
        if isBanned then
            banStatus = "HWID BANNED"
        else
            banStatus = "HWID is clean"
        end
    else
        banStatus = "Error checking ban status"
        print("Error checking ban status: " .. tostring(isBanned))
    end
else
    banStatus = "Error: JC012-RH"
end

-- Update the ban status field in Discord embed
for i, field in ipairs(data.embeds[1].fields) do
    if field.name == "HWID Ban Status" then
        field.value = banStatus
        break
    end
end

-- Validate and send webhook
local success, encoded = pcall(function()
    return HttpService:JSONEncode(data)
end)

if not success then
    print("JSON encoding failed")
    return
end

local requestFunc = syn and syn.request or request or http_request
if not requestFunc then
    print("Error: JK291-RH")
    return
end

local response = requestFunc({
    Url = url,
    Method = "POST",
    Headers = {
        ["Content-Type"] = "application/json"
    },
    Body = encoded
})

if response then
    print("Status:", response.StatusCode)
    if response.StatusCode == 200 or response.StatusCode == 204 then
    else
        print("Error: J1920-RH - (SHARE THIS TO SERVICE OWNER) : " .. response.StatusCode)
        if response.Body then
            print("Response: " .. response.Body)
        end
    end
else
    print("ERROR: No response from server")
end
